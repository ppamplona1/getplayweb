package pt.uc.dei.aor.projeto3.grupod.managedBeans;

import java.io.Serializable;
import java.util.Collections;
import java.util.GregorianCalendar;
import java.util.List;
import java.util.logging.Level;
import java.util.logging.Logger;
import javax.annotation.PostConstruct;
import javax.enterprise.context.RequestScoped;
import javax.enterprise.context.SessionScoped;
import javax.faces.bean.ViewScoped;

import javax.inject.Inject;
import javax.inject.Named;
import pt.uc.dei.aor.projeto3.grupod.ejb.UserLogedEJB;
import pt.uc.dei.aor.projeto3.grupod.entities.Music;

import pt.uc.dei.aor.projeto3.grupod.entities.Playlist;
import pt.uc.dei.aor.projeto3.grupod.exceptions.PlaylistNameException;
import pt.uc.dei.aor.projeto3.grupod.facades.PlaylistFacade;

@Named
@RequestScoped
public class PlaylistController implements Serializable {

    @Inject
    private UserLogedEJB userEJB;

    @Inject
    private PlaylistFacade playlistFacade;

   
    private String messageError;

    private Playlist activePlaylist;
    private Playlist selectedPlaylist;
    private Playlist thePlaylistByID;

    private long playlistID;

    private long musicID;

    public PlaylistController() {
    }

    @PostConstruct
    public void init() {
        if (activePlaylist == null) {
            activePlaylist = new Playlist();
        }
    }

    public Playlist getThePlaylistByID() {

        thePlaylistByID = playlistFacade.findPlaylistsByID(playlistID);

        return thePlaylistByID;
    }

    public void setThePlaylistByID(Playlist thePlaylistByID) {
        this.thePlaylistByID = thePlaylistByID;
    }

    public long getMusicID() {
        return musicID;
    }

    public void setMusicID(long musicID) {
        this.musicID = musicID;
    }

    public PlaylistFacade getPlaylistFacade() {

        return playlistFacade;
    }

    public void setPlaylistFacade(PlaylistFacade playlistFacade) {
        this.playlistFacade = playlistFacade;
    }

    public UserLogedEJB getUserEJB() {
        return userEJB;
    }

    public void setUserEJB(UserLogedEJB userEJB) {
        this.userEJB = userEJB;
    }

    public Playlist getActivePlaylist() {

        return activePlaylist;
    }

    public void setActivePlaylist(Playlist activePlaylist) {
        this.activePlaylist = activePlaylist;
    }

    public Playlist getSelectedPlaylist() {
        return selectedPlaylist;
    }

    public void setSelectedPlaylist(Playlist selectedPlaylist) {
        this.selectedPlaylist = selectedPlaylist;
    }

    public long getPlaylistID() {
        return playlistID;
    }

    public void setPlaylistID(long playlistID) {
        this.playlistID = playlistID;
    }

   
    public String getMessageError() {
        return messageError = playlistFacade.getMessageError();
    }

    public void setMessageError(String messageError) {
        this.messageError = messageError;
    }

    /**
     * Creates a new Playlist
     *
     * @return The String that leads to a XHTML window
     */
    public String newPlaylist() {

        GregorianCalendar gc = new GregorianCalendar();
        activePlaylist.setCreationDate(gc.getTime());
        activePlaylist.setUser(userEJB.getUser());

        String result = playlistFacade.newPlaylist(activePlaylist);
        return result;
    }

    public String goToEditPlaylist(Playlist p) {

        activePlaylist = p;
        playlistID = p.getPlaylistID();
        return "editPlaylist";

    }

    

    public String edit() {

        try {
            playlistFacade.searchPlaylist(activePlaylist);
        } catch (PlaylistNameException ex) {
            Logger.getLogger(PlaylistController.class.getName()).log(Level.SEVERE, null, ex);
            messageError = ex.getMessage();
            return "editPlaylist";
        }
        Playlist play = playlistFacade.findPlaylistsByID(playlistID);
        play.setName(activePlaylist.getName());
        playlistFacade.edit(play);

        return "myPlaylists";
    }

 
}
